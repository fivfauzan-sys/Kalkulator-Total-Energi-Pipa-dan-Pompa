<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <title>Kalkulator Energi Perpipaan - Multi Material</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #f4f7f6; padding: 20px; color: #333; }
        .container { max-width: 1000px; margin: auto; background: white; padding: 30px; border-radius: 15px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); }
        h2 { color: #1a73e8; text-align: center; border-bottom: 2px solid #eee; padding-bottom: 15px; margin-bottom: 25px; }
        .section-title { background: #e8f0fe; color: #1a73e8; padding: 10px 15px; border-radius: 6px; margin: 20px 0 10px 0; font-weight: bold; font-size: 0.9em; }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 15px; margin-bottom: 20px; }
        .input-box { display: flex; flex-direction: column; }
        label { font-size: 0.8em; font-weight: bold; margin-bottom: 5px; color: #666; }
        input, select { padding: 12px; border: 1px solid #dadce0; border-radius: 8px; font-size: 14px; }
        input:focus, select:focus { border-color: #1a73e8; outline: none; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; font-size: 0.85em; }
        th, td { border: 1px solid #eee; padding: 10px; text-align: center; }
        th { background: #f8f9fa; color: #555; }
        .result-card { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-top: 30px; }
        .box { padding: 20px; border-radius: 12px; border: 1px solid #e0e0e0; background: #fff; }
        .highlight { font-size: 1.5em; font-weight: bold; color: #1a73e8; display: block; margin: 5px 0; }
        .status-tag { padding: 8px 15px; border-radius: 6px; font-weight: bold; text-align: center; display: inline-block; width: 100%; box-sizing: border-box; }
        .safe { background: #e6f4ea; color: #1e8e3e; }
        .danger { background: #fce8e6; color: #d93025; }
    </style>
</head>
<body>

<div class="container">
    <h2>üåä Audit Energi & Kehilangan Tekanan</h2>

    <div class="section-title">‚öôÔ∏è DATA INPUT & MATERIAL PIPA</div>
    <div class="grid">
        <div class="input-box">
            <label>Pilih Material Pipa:</label>
            <select id="material_select" onchange="updateMaterial()">
                <option value="baja" selected>Baja (Steel)</option>
                <option value="hdpe">HDPE / PVC</option>
                <option value="gi">GI (Galvanis)</option>
                <option value="castiron">Cast Iron</option>
                <option value="beton">Beton</option>
            </select>
        </div>
        <div class="input-box"><label>Koef. H-W (C):</label><input type="number" id="C" value="100" readonly style="background:#f0f0f0"></div>
        <div class="input-box"><label>Kekasaran Œµ (mm):</label><input type="number" id="epsilon" value="0.000045" readonly style="background:#f0f0f0"></div>
        <div class="input-box"><label>Debit (LPS):</label><input type="number" id="Q_lps" value="250" oninput="calculate()"></div>
    </div>

    <div class="grid">
        <div class="input-box"><label>Diameter Pipa (m):</label><input type="number" id="D" value="0.40" step="0.01" oninput="calculate()"></div>
        <div class="input-box"><label>Panjang Pipa (m):</label><input type="number" id="L" value="190.6" oninput="calculate()"></div>
        <div class="input-box"><label>Elevasi LWL (m):</label><input type="number" id="el_lwl" value="29.09" step="0.01" oninput="calculate()"></div>
        <div class="input-box"><label>Elevasi Outlet (m):</label><input type="number" id="el_out" value="38.17" step="0.01" oninput="calculate()"></div>
    </div>

    <div class="section-title">üîß FITTING & MINOR LOSSES (K-FACTOR)</div>
    <table>
        <thead><tr><th>Fitting</th><th>Koef (K)</th><th>Jumlah</th><th>Total K</th></tr></thead>
        <tbody id="fitting-table"></tbody>
    </table>

    <div class="result-card">
        <div class="box">
            <label>KECEPATAN ALIRAN (v)</label>
            <span class="highlight" id="res_v">0.00 m/s</span>
            <div id="v_status" class="status-tag safe">Status: OK</div>
        </div>
        <div class="box">
            <label>TOTAL ENERGI SYSTEM</label>
            <span class="highlight" id="res_total">0.00 m</span>
            <div id="energy_status" class="status-tag safe">Energi Terpenuhi</div>
        </div>
    </div>

    <div class="section-title">üìù RINCIAN AUDIT (HAZEN-WILLIAMS)</div>
    <div class="box" style="font-size: 0.9em; line-height: 1.6;">
        Mayor Losses ($H_f$): <span id="det_hf" style="font-weight:bold">0.00 m</span><br>
        Minor Losses ($H_m$): <span id="det_hm" style="font-weight:bold">0.00 m</span><br>
        Head Statis ($H_s$): <span id="det_hs" style="font-weight:bold">0.00 m</span>
    </div>
</div>

<script>
// Data Tabel Koefisien
const materialData = {
    hdpe: { c: 150, eps: 0.0000015 },
    baja: { c: 100, eps: 0.000045 },
    gi: { c: 100, eps: 0.0005 },
    castiron: { c: 83, eps: 0.00026 },
    beton: { c: 120, eps: 0.0003 }
};

const fittings = [
    { name: 'Check Valve', k: 2, qty: 1 },
    { name: 'Air Release Valve', k: 0.8, qty: 1 },
    { name: 'Elbow 90¬∞', k: 0.9, qty: 1 },
    { name: 'Elbow 45¬∞', k: 0.4, qty: 1 },
    { name: 'Flange per 6m', k: 0.05, qty: 31 }
];

function updateMaterial() {
    const mat = document.getElementById('material_select').value;
    document.getElementById('C').value = materialData[mat].c;
    document.getElementById('epsilon').value = materialData[mat].eps;
    calculate();
}

function calculate() {
    const L = parseFloat(document.getElementById('L').value) || 0;
    const D = parseFloat(document.getElementById('D').value) || 0.1;
    const Q = (parseFloat(document.getElementById('Q_lps').value) || 0) / 1000;
    const C = parseFloat(document.getElementById('C').value) || 100;
    const el_lwl = parseFloat(document.getElementById('el_lwl').value) || 0;
    const el_out = parseFloat(document.getElementById('el_out').value) || 0;
    const Hp = 15; // Head Pompa Default dari data gambar

    // 1. Kecepatan
    const area = 0.25 * Math.PI * Math.pow(D, 2);
    const v = Q / area;

    // 2. Major Losses (H-W)
    const hf = 10.67 * (Math.pow(Q, 1.852) / (Math.pow(C, 1.852) * Math.pow(D, 4.87))) * L;

    // 3. Minor Losses
    const totalK = fittings.reduce((acc, f) => acc + (f.k * f.qty), 0);
    const hm = totalK * (Math.pow(v, 2) / (2 * 9.81));

    // 4. Head Statis & Total Energi
    const hs = el_lwl - el_out;
    const totalEnergi = Hp + hs - hf - hm;

    // Update UI
    document.getElementById('res_v').innerText = v.toFixed(2) + " m/s";
    document.getElementById('res_total').innerText = totalEnergi.toFixed(2) + " m";
    document.getElementById('det_hf').innerText = hf.toFixed(2) + " m";
    document.getElementById('det_hm').innerText = hm.toFixed(2) + " m";
    document.getElementById('det_hs').innerText = hs.toFixed(2) + " m";

    // Status Audit
    const vStatus = document.getElementById('v_status');
    if (v > 2.0) {
        vStatus.innerText = "Ketinggian (Risiko Losses)";
        vStatus.className = "status-tag danger";
    } else {
        vStatus.innerText = "Kecepatan OK";
        vStatus.className = "status-tag safe";
    }

    const eStatus = document.getElementById('energy_status');
    if (totalEnergi >= 0) {
        eStatus.innerText = "Energi Minimum Terpenuhi";
        eStatus.className = "status-tag safe";
    } else {
        eStatus.innerText = "Energi Tidak Cukup";
        eStatus.className = "status-tag danger";
    }
}

function renderTable() {
    const tbody = document.getElementById('fitting-table');
    tbody.innerHTML = fittings.map((f, i) => `
        <tr>
            <td>${f.name}</td>
            <td>${f.k}</td>
            <td><input type="number" value="${f.qty}" style="width:50px" oninput="fittings[${i}].qty=parseInt(this.value)||0;calculate()"></td>
            <td>${(f.k * f.qty).toFixed(2)}</td>
        </tr>
    `).join('');
}

renderTable();
updateMaterial(); // Initial call
</script>
</body>
</html>